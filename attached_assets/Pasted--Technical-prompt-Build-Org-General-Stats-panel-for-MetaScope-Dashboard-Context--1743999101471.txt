### ðŸ“‘â€¯Technical prompt â€” â€œBuildâ€¯Orgâ€¯Generalâ€¯Statsâ€¯panel forâ€¯MetaScopeâ€¯Dashboardâ€

> **Context**  
> MetaScope already has the **Orgâ€¯Health** dashboard card (donutâ€¯+â€¯barâ€¯+â€¯tableâ€¯+â€¯list) delivered and routed. We now need a *second* card/page that surfaces â€œbigâ€‘pictureâ€ statistics & limits for the connected org. Preserve the existing codebase, stack and routing conventions.

---

#### 1â€¯â€”â€¯Userâ€‘value & UX goals  
| Goal | Why it matters | UX hint |
|------|----------------|---------|
| Show **how big** the org is (users, metadata footprint, automation, integration) | Gives admins a oneâ€‘look sense of org complexity | â€œAtâ€‘aâ€‘glanceâ€ number cards in a responsive grid |
| Show **% of platform limit used** for each metric | Prevents hitting hard limits and supports capacity planning | Circular or horizontal progress bars, red >80â€¯%, yellow 60â€‘80â€¯% |
| Offer **actionable links** (â€œview unused fieldsâ€, â€œbuy more API callsâ€) | Turns insight into next step | `onClick` navigates to existing Analyzer modules |

---

#### 2â€¯â€”â€¯Metrics & where to fetch them  

| Category | Metric | Source query (JSForce / Tooling / REST) | Hard limit reference |
|----------|--------|------------------------------------------|----------------------|
| **People & Licenses** | Total active users | `SELECT COUNT() FROM User WHERE IsActive=true` | n/a |
| | License types & counts | `SELECT LicenseDefinitionKey, COUNT(Id) FROM User GROUP BY LicenseDefinitionKey` | n/a |
| **Cloud enablement** | Enabled Clouds (Sales, Service, etc.) | `Organization.Is*` flags via `Organization` object | n/a |
| **Apps** | Custom Apps | `SELECT COUNT() FROM AppMenuItem WHERE Type='TabSet'` | 2,500 custom apps (EE) îˆ€citeîˆ‚turn0search2îˆ |
| | Connected Apps | `SELECT COUNT() FROM ConnectedApplication` | 2,000 |
| **Objects** | Custom objects | `SELECT COUNT() FROM CustomObject` via Metadata API | 3,000 custom objs (UE) îˆ€citeîˆ‚turn0search2îˆ |
| **Fields** | Custom fields (per object & total) | `Tooling: SELECT TableEnumOrId, COUNT(Id) FROM CustomField GROUP BY TableEnumOrId` | 800â€¯/â€¯object îˆ€citeîˆ‚turn0search3îˆ |
| | Field dataâ€‘type distribution | same query, aggregate on `DataType` | n/a |
| **Code & UI** | Apex classes, triggers | `SELECT COUNT() FROM ApexClass` / `ApexTrigger` | 5â€¯MB compiled per class |
| | Lightning Web Components | Metadataâ€¯API `listMetadata LightningComponentBundle` | 2,000 bundles |
| | Aura bundles | `AuraDefinitionBundle` Tooling query | 5,000 |
| | Visualforce pages | `SELECT COUNT() FROM ApexPage` | 5,000 |
| **Automation** | Flows (active / total) | `SELECT Status, COUNT(Id) FROM FlowDefinition GROUP BY Status` | 2,000 |
| | Scheduled Apex jobs | `SELECT COUNT() FROM CronTrigger` | 100 |
| **Integration & Limits** | Daily API calls (24â€¯h) | REST `/limits` â†’ `DailyApiRequests` | editionâ€‘based calc îˆ€citeîˆ‚turn0search1îˆ |
| | Monthly API entitlement | REST `/limits` â†’ `MonthlyApiRequests` | editionâ€‘based |
| | Platform Events definitions & usage | `SELECT COUNT() FROM CustomObject WHERE DeploymentStatus='Deployed' AND IsPlatformEvent=true`; usage via `/limits` â†’ `DailyStreamingApiEvents` | 250k/24â€¯h |
| **Data & Storage** | Data storage used vs limit | REST `/limits` â†’ `DataStorageMB` | editionâ€‘based |
| | File storage used vs limit | REST `/limits` â†’ `FileStorageMB` | editionâ€‘based |

*(Feel free to stub lessâ€‘critical metrics first; design allows incremental add.)*

---

#### 3â€¯â€”â€¯Backend tasks (Nodeâ€¯+â€¯Expressâ€¯+â€¯JSForce)

1. **`/api/org/:id/general-stats`**  
   *Aggregate all queries above in parallel (Promise.all) and return a flat JSON:*  
   ```ts
   interface OrgStat {
     key: 'users' | 'customObjects' | 'apiDaily' | ...;
     value: number;
     limit?: number;          // undefined when no hard limit
     unit?: 'count' | 'MB' | '%';
   }
   ```
2. Cache results for 15â€¯min in PostgreSQL `org_stats_cache` to avoid limit hits.
3. Add Zod schema validation + Drizzle model.

---

#### 4â€¯â€”â€¯Frontend tasks (Reactâ€¯+â€¯TSâ€¯+â€¯TanStackâ€¯Queryâ€¯+â€¯Tailwind)

1. **Hook** `useOrgGeneralStats(orgId)` â†’ TanStack query fetching endpoint.
2. **`GeneralStatsCard` component**  
   * Responsive CSS grid of `StatTile`s (icon, label, value, progress bar).  
   * Tiles clickable if a deeper analyzer exists (e.g., fields â†’ Field Utilization Analyzer).  
   * Animate entry with Framer Motion.
3. Route `/dashboard/general-stats` and add a small **card** on main Dashboard landing page (beside Orgâ€¯Health card).  

---

#### 5â€¯â€”â€¯Acceptance criteria

- âœ… 95â€¯%+ Lighthouse performance; no regression to existing Orgâ€¯Health card.  
- âœ… Loading skeletons & error states implemented.  
- âœ… Unit tests for backend aggregation service; React Testing Library tests for `StatTile`.  
- âœ… Works on mobile viewport â‰¤â€¯375â€¯px.  
- âœ… Limits & usage numbers match Setupâ€¯â†’â€¯Systemâ€¯Overview for the same org (Â±5â€¯%).  

---

#### 6â€¯â€”â€¯Stretch / future ideas

| Idea | Effort | Benefit |
|------|--------|---------|
| Heatâ€‘map of API calls over last 30â€¯days (line chart) | M | Trend visibility |
| Unused custom fields & objects count | M | Cleanup insights |
| Apex code coverage % | M | DevOps quality |
| Package dependency size (managed pkg count, unlocked pkgs) | S | Complexity signal |
| API version distribution of Apex classes | S | Upgrade planning |

---

#### 7â€¯â€”â€¯Questions for product owner

1. Any editionâ€‘specific metrics we should hide to avoid confusion?  
2. Preferred colour thresholds for â€œwarningâ€ and â€œcriticalâ€ usage?  
3. Should we expose *limits without usage* (e.g., LWC bundles) or hide until >0â€¯%?

---

### Ready for dev ðŸš€  
Use this prompt as the single source of truth for implementing the **Orgâ€¯Generalâ€¯Stats** panel while preserving existing MetaScope functionality.